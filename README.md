# Subscription-Service

Этот проект реализует RESTful API для управления подписками пользователей, разработанный на Go. Он позволяет создавать, получать, обновлять и удалять подписки, а также просматривать список всех подписок и получать сводку по расходам.

## Оглавление
- [Структура проекта](#структура-проекта)
- [Начало работы](#начало-работы)
  - [Предварительные требования](#предварительные-требования)
  - [Запуск приложения](#запуск-приложения)
- [Документация API (Swagger)](#документация-api-swagger)
- [Запуск тестов](#запуск-тестов)
- [Использование Makefile](#использование-makefile)
- [Комментарии к коду](#комментарии-к-коду)
- [Ограничение частоты запросов (Rate Limiting)](#ограничение-частоты-запросов-rate-limiting)

## Структура проекта

```
.
├── cmd/
│       └── main.go               # Точка входа в приложение
├── internal/
│   ├── config/                   # Загрузка конфигурации
│   │   └── config.go
│   ├── middleware/               # HTTP-промежуточное ПО (например, ограничение частоты запросов)
│   │   └── middleware.go
│   ├── models/                   # Структуры данных для подписок и запросов
│   │   └── models.go
│   ├── repository/               # Логика взаимодействия с базой данных (PostgreSQL)
│   │   └── postgres.go
│   │   └── postgres_test.go
│   │   └── storage.go
│   ├── router/                   # HTTP-маршрутизатор и определения обработчиков
│   │   ├── handlers/
│   │   │   └── handlers.go
│   │   │   └── handlers_test.go
│   │   └── router.go
│   └── service/                  # Бизнес-логика для управления подписками
│       └── service.go
├── pkg/
│   └── logger/                   # Централизованная утилита логирования
│       └── logger.go
├── migrations/
│   └── 00001_init.sql            # SQL-скрипты миграции
├── docs/                         # Файлы документации Swagger
│   └── docs.go
│   └── swagger.json
│   └── swagger.yaml
├── config/
│   └── config.yaml               # Файл конфигурации приложения
├── docker-compose.yaml           # Docker Compose для настройки локальной разработки
├── Dockerfile                    # Dockerfile для сборки образа приложения
├── go.mod                        # Зависимости Go-модулей
├── go.sum                        # Контрольные суммы Go-модулей
├── Makefile                      # Автоматизация общих задач
└── README.md                     # Документация проекта
```

## Начало работы

### Предварительные требования
- Go (версия 1.20 или выше)
- Docker и Docker Compose
- Клиент PostgreSQL (опционально, для прямого взаимодействия с базой данных)

### Запуск приложения

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <repository_url>
    cd effective_mobile_app
    ```

2.  **Настройте переменные окружения:**
    Приложение ожидает, что переменная окружения `CONFIG_PATH` будет указывать на ваш файл `config.yaml`. По умолчанию он ищет `./config/config.yaml`.

    Вы можете создать файл `config.yaml` в каталоге `config/` (или использовать предоставленный):
    ```yaml
    storage:
      user: postgres
      password: password
      host: localhost
      port: "5432"
      dbname: subscriptions_db
      ssl_mode: disable
    rest:
      addr: ":8080"
    ```

3.  **Запуск с Docker Compose (рекомендуется для локальной разработки):**
    Это настроит базу данных PostgreSQL и запустит Go-приложение.
    ```bash
    docker-compose up --build
    ```
    Приложение будет доступно по адресу `http://localhost:8080`.

4.  **Запуск нативно (требуется локальная установка PostgreSQL):**
    a. Убедитесь, что у вас запущена база данных PostgreSQL, настроенная в соответствии с `config.yaml`.
    b. Соберите и запустите приложение:
       ```bash
       go mod tidy
       go run cmd/main.go
       ```

## Документация API (Swagger)

Документация Swagger доступна по адресу `http://localhost:8080/swagger/index.html` после запуска приложения. Вы можете сгенерировать или обновить документацию Swagger с помощью Makefile:

```bash
make swagger
```

## Запуск тестов

Чтобы запустить все юнит-тесты для проекта:

```bash
make test
```

## Использование Makefile

`Makefile` предоставляет удобные команды для общих задач разработки:

-   `make all`: Собирает исполняемый файл приложения.
-   `make build`: Собирает исполняемый файл приложения (то же, что и `all`).
-   `make run`: Запускает собранный исполняемый файл приложения.
-   `make test`: Запускает все юнит-тесты.
-   `make clean`: Удаляет собранные исполняемые файлы и сгенерированные файлы Swagger.
-   `make swagger`: Генерирует или обновляет документацию Swagger API.

## Комментарии к коду

Обширные комментарии были добавлены к сложным частям кода, особенно в пакетах `handlers`, `service` и `repository`, чтобы объяснить бизнес-логику, поток данных и нетривиальные алгоритмы.

## Ограничение частоты запросов (Rate Limiting)

Ограничение частоты запросов было реализовано с использованием промежуточного ПО `golang.org/x/time/rate`. По умолчанию оно разрешает 1 запрос в секунду с "всплеском" в 5 запросов. Это помогает защитить API от злоупотреблений и обеспечивает справедливое использование.


